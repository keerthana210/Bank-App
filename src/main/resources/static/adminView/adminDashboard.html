<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Admin Dashboard - Hira Bank</title>
    <link rel="shortcut icon" href="\favicon.png" type="image/png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        font-family: "Roboto", sans-serif;
        background-color: #f4f4f9;
      }

      header {
        position: relative;
        background-color: #43169d;
        color: white;
        padding: 20px 40px;
        text-align: center;
        font-size: 24px;
        font-weight: bold;
      }
      header img{
         max-width: 300px;
        height: auto;
      }

      .logout-btn {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        padding: 8px 16px;
        background-color: #fff;
        color: #43169d;
        font-weight: bold;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
      }

      .logout-btn:hover {
        background-color: #ddd;
      }

      .dashboard {
        display: grid;
        grid-template-columns: 1fr 3fr;
        height: 100vh;
      }

      .sidebar {
        background-color: rgb(148, 121, 202);
        padding: 20px;
        color: white;
      }

      .sidebar h3 {
        margin-top: 0;
      }

      .sidebar ul {
        list-style: none;
        padding: 0;
      }

      .sidebar li {
        padding: 12px 8px;
        cursor: pointer;
        border-radius: 6px;
        margin-bottom: 10px;
        background-color: #4d3cc7;
        transition: background 0.3s ease;
      }

      .sidebar li:hover {
        background-color: #2c1e7a;
      }

      .content {
        padding: 30px;
        overflow-y: auto;
        justify-content: center;
        background-color: rgb(225, 217, 237);
      }

      .card {
        background-color: white;
        padding: 20px 40px;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        max-width: 600px;
        margin: 20px auto;
        justify-self: center;
        width: 100%;
      }

      .card h2 {
        margin-top: 0;
        font-size: 20px;
        color: #43169d;
      }

      .card#listOfCustomers,
      #searchTransactions {
        width: 95%;
        max-width: 1200px;
        height: calc(100vh - 100px);
        overflow-y: auto;
        margin: 20px auto;
      }

      .profile-details p {
        margin: 6px 0;
      }

      .transaction-buttons {
        display: flex;
        gap: 20px;
      }

      .transaction-buttons button {
        padding: 10px 20px;
        border: none;
        background-color: #43169d;
        color: white;
        border-radius: 6px;
        cursor: pointer;
      }

      .transaction-buttons button:hover {
        background-color: #2c1e7a;
      }

      .profile-details {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 15px;
      }

      .detail-row {
        display: flex;
        justify-content: space-between;
        border-bottom: 1px solid #eee;
        padding: 6px 0;
      }

      th,
      td {
        justify-content: center;
        border: 1px solid;
      }

      .statement-table {
        border: 1px solid;
        border-color: #43169d;
        border-spacing: 0px;
      }

      .label {
        font-weight: bold;
        color: #444;
      }

      .value {
        color: #333;
      }

      .admin-form {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      .form-group label {
        margin-bottom: 5px;
        font-weight: bold;
        color: #333;
      }

      .form-group input,
      select {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 14px;
      }

      .submit-btn {
        padding: 12px;
        background-color: #43169d;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 10px;
      }

      .submit-btn:hover {
        background-color: #2c1e7a;
      }

      .table-container {
        overflow-x: auto;
      }

      .customer-table,
      .transaction-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      .customer-table th,
      .customer-table td,
      .transaction-table th,
      .transaction-table td {
        border: 1px solid #ccc;
        padding: 12px 10px;
        text-align: center;
      }

      .customer-table th,
      .transaction-table th {
        background-color: #43169d;
        color: white;
      }

      .customer-table tr:nth-child(even),
      .transaction-table tr:nth-child(even) {
        background-color: #f9f9f9;
      }

      .customer-table tr:hover,
      .transaction-table tr:hover {
        background-color: #eaeaea;
      }
    </style>
  </head>

  <body>
    <header>
      <img src="/bankName.png" alt="Hira Bank" />
      <p>Welcome, <span id="adminName">Admin</span>!</p>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </header>

    <div class="dashboard">
      <div class="sidebar">
        <h3>Menu</h3>
        <ul id="menuList">
          <li onclick="showSection('profile')">Profile</li>
          <li onclick="showSection('searchUser')">Search User</li>
          <li onclick="showCustomers()">List of Users</li>
          <li onclick="showSection('searchTransactions')">
            Search Transactions
          </li>
        </ul>
      </div>

      <div class="content">
        <!-- Profile -->
        <div id="profile" class="card">
          <h2>Your Profile</h2>
          <div class="profile-details">
            <div class="detail-row"></div>
            <div class="detail-row">
              <span class="label">Admin ID</span>
              <span class="value">HiraAdmin001</span>
            </div>
            <div class="detail-row">
              <span class="label">Name</span>
              <span class="value">Keerthana</span>
            </div>
            <div class="detail-row">
              <span class="label">Email</span>
              <span class="value">keer@example.com</span>
            </div>
            <div class="detail-row">
              <span class="label">Contact Number</span>
              <span class="value">9000567890</span>
            </div>
          </div>
        </div>

        <!-- Search User -->
        <div id="searchUser" class="card" style="display: none">
          <h2>Search User by Account Number</h2>
          <form onsubmit="redirectToSearchUser(event)" class="admin-form">
            <div class="form-group">
              <label for="accNumber">Account Number</label>
              <input
                type="text"
                id="accNumber"
                name="accNumber"
                placeholder="Enter Account Number"
                required
              />
            </div>
            <button type="submit" class="submit-btn">Search</button>
          </form>
        </div>

        <!-- List of Customers -->
        <div id="listOfCustomers" class="card" style="display: none">
          <h2>List of Hira Bank Customers</h2>
          <div class="table-container">
            <table class="customer-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Account Number</th>
                  <th>Name</th>
                  <th>Location</th>
                  <th>Email</th>
                  <th>Contact</th>
                  <th>Account Balance</th>
                </tr>
              </thead>
              <tbody id="customerTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- Add Admin -->
        <div id="addAdmin" class="card" style="display: none">
          <h2>Add New Admin</h2>
          <form id="adminForm" method="POST" class="admin-form" novalidate>
            <div class="form-group">
              <label for="adminName">Name</label>
              <input
                type="text"
                id="adminName"
                name="adminName"
                placeholder="Name"
                required
              />
              <small
                id="adminNameError"
                style="color: red; display: none"
              ></small>
            </div>

            <div class="form-group">
              <label for="emailId">Email</label>
              <input
                type="email"
                id="emailId"
                name="emailId"
                placeholder="Email ID"
                pattern="^[a-zA-Z0-9._%+-]+@hirabank\.com$"
                title="Email must end with @hirabank.com"
                required
              />
              <small id="emailError" style="color: red; display: none"></small>
            </div>

            <div class="form-group">
              <label for="contactNumber">Contact</label>
              <input
                type="text"
                id="contactNumber"
                name="contactNumber"
                placeholder="Contact Number"
                pattern="^[6-9][0-9]{9}$"
                title="Contact must be 10 digits and start with 6,7,8,9"
                required
              />
              <small
                id="contactError"
                style="color: red; display: none"
              ></small>
            </div>

            <div class="form-group">
              <label for="access">Access</label>
              <select id="access" name="access" required>
                <option value="">-- Select Access Type --</option>
                <option value="PARTIAL_ACCESS">PARTIAL_ACCESS</option>
                <option value="FULL_ACCESS">FULL_ACCESS</option>
              </select>
              <span class="error" id="accessError"></span>
            </div>

            <button type="submit" class="submit-btn">Submit</button>
            <div
              id="adminMessage"
              style="margin-top: 10px; font-weight: bold"
            ></div>
          </form>
        </div>

        <!-- Search Transactions -->
        <div id="searchTransactions" class="card" style="display: none">
          <h2>Search Transactions by Account Number</h2>
          <form id="transactionSearchForm" class="admin-form">
            <div class="form-group">
              <label for="transactionAccountNumber">Account Number</label>
              <input
                type="text"
                id="transactionAccountNumber"
                name="transactionAccountNumber"
                placeholder="Enter Account Number"
                required
              />
            </div>
            <button type="submit" class="submit-btn">Search</button>
          </form>
          <div class="table-container" style="margin-top: 20px">
            <table class="transaction-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Time</th>
                  <th>From</th>
                  <th>To</th>
                  <th>Amount</th>
                  <th>Balance</th>
                  <th>Message</th>
                </tr>
              </thead>
              <tbody id="transactionResults"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
<script>
  async function validateSession() {
    try {
      const res = await fetch("/admin/current", { cache: "no-store" });
      if (!res.ok) {
        window.location.href = "/index.html?session=expired";
        return false;
      }
      return true;
    } catch {
      window.location.href = "/index.html?session=expired";
      return false;
    }
  }

  async function checkAdminSession() {
    try {
      const response = await fetch("/admin/current", { method: "GET", cache: "no-store" });
      if (!response.ok) {
        window.location.href = "/index.html?session=expired";
        return null;
      }
      const admin = await response.json();
      const usernameElement = document.getElementById("adminName");
      if (usernameElement) usernameElement.textContent = admin.adminName;
      return admin;
    } catch (error) {
      window.location.href = "/index.html?session=expired";
      return null;
    }
  }

  function logout() {
    fetch("/admin/logout", { method: "POST" }).finally(() => {
      window.location.href = "/index.html?logout=success";
    });
  }

   window.addEventListener("pageshow", async function (event) {
    const admin = await checkAdminSession();
    if (!admin) {
      window.location.href = "/index.html?session=expired";
    }
  });

   window.addEventListener("popstate", async function () {
    const valid = await validateSession();
    if (!valid) {
      window.location.href = "/index.html?session=expired";
    }
  });

 window.onload = async () => {
    await validateSession();
    await checkAdminSession();
  };
</script>

    <script src="admin-dashboard.js"></script>
  </body>
</html>
